<!doctype html>
<!doctype html>
<html lang="en">
    <head>
        <link rel="shortcut icon" type="image/x-icon" href="/aow4db/favicon.ico" />
        <link rel="stylesheet" type="text/css" href="/aow4db/Style/style.css" />
        <meta charset="UTF-8" />
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.4/jquery.min.js"></script>
        <script src="/aow4db/Data/Init.js"></script>
        <script>
            function HandlePage() {
                const sections = [
                    "OneHanded",
                    "Shield",
                    "TwoHanded",
                    "Polearm",
                    ".Bow",
                    "Crossbow",
                    "MagicalOrb",
                    "Staff",
                    "OtherWeapon",
                    "DragonClaw",
                    "EldritchRelic",
                    "Giant",
                    "Head",
                    "Torso",
                    "Legs",
                    "Ring",
                    "Wand",
                    "OtherItem"
                ];

                const type = ["Active", "Passive"];
                for (let i = 0; i < type.length; i++) {
                    const entry = type[i];
                    const listWithArgument = [];
                    for (let i = 0; i < jsonItemForge.length; i++) {
                        //const exists = jsonItemForge[i].itemType.some((e) => e.indexOf(entry) != -1);
                        const exists = jsonItemForge[i].entryName.indexOf(entry) != -1;
                        if (exists) {
                            listWithArgument.push(jsonItemForge[i]);
                        }
                    }

                    let buttonHolder = document.getElementById("buttonHolder");
                    let btn = document.createElement("BUTTON");
                    btn.type = "button";

                    btn.innerHTML = entry + " (" + listWithArgument.length + ")";

                    btn.setAttribute("onclick", "openDiv(event,'" + entry + "',true)");
                    btn.setAttribute("id", entry + "-button");
                    buttonHolder.appendChild(btn);
                    let dataHolder;
                    let holderHeight = buttonHolder.offsetHeight;

                    btn.className = "w3-bar-item w3-button tablink";
                    dataHolder = document.getElementById("dataHolder");
                    holderHeight = buttonHolder.offsetHeight;

                    dataHolder.setAttribute("style", "margin-top:-" + holderHeight + "px;");

                    let div = document.createElement("DIV");

                    div.className = "w3-container w3-border city";
                    div.setAttribute("id", entry);

                    dataHolder.appendChild(div);

                    CheckLengths(entry, listWithArgument);
                }

                $("#filterInput").on("change input", function () {
                    ShowAllDivsWithFilters("mod_card");
                    SetLevelUpStuff();
                });
            }

            function ShowInfusion(test, holder) {
                const name = holder.querySelector("#modname");
                const description = holder.querySelector("#moddescription");
                if (test.datastoreTag != null) {
                    //

                    name.innerHTML = test.entryName;

                    // name
                    const parts = test.screenName.split("@");
                    const baseId = parts.slice(0, -1).join("@");
                    const suffix = parts[parts.length - 1].toLowerCase();

                    // descr
                    const parts2 = test.screenDescription.split("@");

                    const suffix2 = parts2[parts2.length - 1].toLowerCase();

                    const valueLookup = findBy(jsonAllFromPOLocalized, "id", baseId);
                  //  console.log(suffix);
                   
                    

                    const ability = findBy(jsonUnitAbilities, "name", valueLookup[suffix]);
  
                    if (ability) {
                        let spa;
                        spa= GetAbilityInfo(ability);
                        description.append(spa);
                    } else{
                         description.innerHTML = valueLookup[suffix] + "<br>";

                    description.innerHTML += "<br>" + valueLookup[suffix2] + "<br>";
                    }
                    
                    // get spawnset if available
                     const data = test.datastoreTag.split("_");
                    // spell name minus upgrade
                    let spell_cat = data.slice(0, -1).join("_");
                
                    console.log(spell_cat + "_CAT");
                    // misspelled
                    if(spell_cat == "SUMMON_UMBAL_DEMON"){
                        spell_cat = "SUMMON_UMBRAL_DEMON";
                    }
                    
                  
                    const spawnTable = findBy(jsonSpawnTables, "category", spell_cat+"_CAT");
                    
                    if(spawnTable){
                        let div = ConvertSpawnTable(spawnTable, "Summon");
                        description.appendChild(div);
                    }
                 
                    
                       description.innerHTML += "<br>" + test.unlockSettings + "<br>";
                    description.innerHTML += "<br>" + test.tagFilter + "<br>";
                    description.innerHTML += "<br>" + test.itemType + "<br>";

                    //  text.innerHTML += test.lore_description ? test.lore_description : "";
                    //  text.innerHTML += test.description;
                }
            }
            async function CheckLengths(argument, list) {
                let card = await spawnSpellCards(list, argument);
                for (let i = 0; i < list.length; i++) {
                    ShowInfusion(list[i], card[i]);
                }
            }
        </script>

        <title>Age of Wonders 4 Database - Infusions List</title>
    </head>

    <body>
        <div id="header"></div>

        <div class="textblocktitle">Infusions List</div>
        <div style="height: auto; color: white; text-align: center">
            <br />
            Filter<br />
            <div style="margin-right: auto; margin-left: auto; width: 500px">
                <input type="text" class="searchbar" id="filterInput" />
            </div>
        </div>

        <div class="w3-container">
            <div class="w3-bar w3-black" id="buttonHolder"></div>

            <div id="dataHolder" class="divContainer">
                <div id="Test" class="mod_card"></div>
            </div>
        </div>
    </body>
</html>
<footer>
    <br />
    <br />
</footer>
